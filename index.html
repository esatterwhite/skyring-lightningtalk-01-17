<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/blood.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  <body>
    <div class="reveal">
    <div class="slides">
      <section>The Delayed `Delayed Work` Problem</section>
      <section>
        <section>Delay execution for <code>X</code> amount of time</section>
        <section>Exectue as soon as time has lapsed</section>
        <section>Execute <em>Exactly</em> once</section>
        <section>Ability to cancel execution</section>
      </section>
    <section>
      <h4>setTimeout / clearTimeout</h4>
      <p class="fragment fade-up">Asynchronous</p>
      <p class="fragment fade-up">Non-Blocking</p>
      <p class="fragment fade-up">High Resolution (ms)</p>
      <p class="fragment fade-up">Cancelable</p>
      <p class="fragment fade-up"><em><strong>Exactly Once</strong></em> Execution Guarantees</p>
      <aside class="notes">
      The solution is staring you in the face
      Does all of the things we want
      </aside>
    </section>
    <section>
      <div><strong>10 Lines of Code ( literally )</strong></div>
      <pre>
        <code data-trim datra-noescape class="js">
        const timers = Object.create(null);
        function set(id, amount, fn) {
          if (!timers[id]) {
            timers[id] = setTimeout( fn, amount ).unref();
          }
        }

        function cancel(id) {
          const ref = timers[id];
          return ref && clearTimeout( ref );
        }
        </code>
      </pre>
      <aside class="notes">
      code is:
      <ul>
        <li>excplicit in what it does</li>
        <li>easy to follow</li>
        <li>to the point</li>
      </ul>
      A first year developer who has never seen javascript can understand
      </aside>
    </section>
    <section>
    Timers Live In memory
    </section>
    <section>
      <p class="fragement" data-fragment-index="1"><img src="./img/skyring-inverted.png" style="border:0; background: transparent; max-width: 960"/></p>
      <p class="fragment fade-in" data-fragment-index="2">Distributed Timers - As A Service</p>
    </section>
    
    <section>
      <section>
        <h3>Set A Timer</h3>
        <pre>
          <code data-trim data-noescape class="bash">
          curl -i -XPOST http://localhost:2300/timer -d '{
            "timeout": 10000
          , "data": "Hello!"
          , "callback": {
              "transport": "http"
            , "uri": "http://some.domain.com/world"
            , "method": "post"
            }
          }'
          -H "Content-Type: application/json"
          </code>
        </pre>
      </section>
      <section>
        <h4>Response</h4>
        <pre>
          <code data-trim data-noescape class="http">
          HTTP/1.1 201 CREATED
          location: /timer/4adb026b-6ef3-44a8-af16-4d6be0343ecf
          Date: Fri, 23 Dec 2016 00:19:13 GMT
          Connection: keep-alive
          Content-Length: 0
          </code>
        </pre>
      </section>
    </section>

    <section>
      <section>
        <h3>Cancel A Timer</h3>
        <pre>
          <code data-trim data-noescape class="bash">
          curl -i -XDELETE http://localhost:2300/timer/4adb026b-6ef3-44a8-af16-4d6be0343ecf
          </code>
        </pre>
      </section>
      <section>
        <h3>Response</h3>
        <pre>
          <code data-trim data-noescape class="http">
          HTTP/1.1 202 Accepted
          Date: Fri, 23 Dec 2016 00:22:12 GMT
          Connection: keep-alive
          Content-Length: 0
          </code>
        </pre>
        <aside class="notes">
          <ul>
            <li>All relevant info in headers</li>
            <li>easier to deal with</li>
            <li>no payload is always faster</li>
          <ul>
        </aside>
      </section>
    </section>
    
    <section>
      <section>
        <h3>Hashring</h3>
        <img src="./img/s01.png" style="border:0; background: transparent; max-width: 80%"/>
        <aside class="notes">
        <ul>
          <li>nodes are aligned in a hashing w/ persistent tcp connection</li>
          <li>Each node responsible for a section of key</li>
          <li>Given an KEY, know exactly which server is responsible</li>
          <li>one network hop</li>
          <li>true horizontal scale - no p2p / message bus</li>
        </ul>
        </aside>
      </section>
      <section>
        <h3>Join &amp; Rebalance</h3>
        <img src="./img/s02.png" style="border:0; background: transparent; max-width: 80%"/>
        <aside class="notes">
          <ul>
            <li>when a new node joins the ring, who is responsible changes</li>
            <li>automatically redistributes timers</li>
          </ul>
        </aside>
      </section>
      <section>
        <h3>Leave &amp; Rebalance</h3>
        <img src="./img/s03.png" style="border:0; background: transparent; max-width: 80%"/>
        <aside class="notes">
          <ul>
            <li>Leaving is tricky</li>
            <li>No longer a member of the ring</li>
            <li>NATS messaging layer</li>
            <li>Nodes in NATS group - random distribution</li>
            <li>business as usual</li>
          </ul>
        </aside>
      </section>
      <section>
        <h3>Bird's eye view</h3>
        <img src="./img/skyring-arch-inverted.png" style="border:0; background: transparent; max-width: 75% "/>
        <aside class="notes">
        </aside>
      </section>
    </section>
    <section>
      <p><h3>DEMO</h3></p>
    </section>
    <section style="text-align: left;">
      <h2>Eric Satterwhite</h2>
      I work at Help.com - We do Node.js
      <br/>
      <br/>
      <ul>
        <li>codedependant / esatterwhite</li>
        <li>website: codedependant.net</li>
        <li>twitter: codedependant</li>
        <li>github: github.com/esatterwhite</li>
      </ul>
      <h2>Skyring</h2>
      <ul>
        <li>github: esatterwhite/skyring</li>
        <li>slides: esatterwhite/skyring-lightningtalk-01-17</li>
      </ul>
    </section>
      </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        history: true,
        width: 1280,
        height: 700,
        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
      });
    </script>
  </body>
</html>
